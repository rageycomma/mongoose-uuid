<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for mongoose-uuid/index.js</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../prettify.css">
    <link rel="stylesheet" href="../base.css">
    <style type='text/css'>
        div.coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class="header medium">
    <h1>Code coverage report for <span class="entity">mongoose-uuid/index.js</span></h1>
    <h2>
        Statements: <span class="metric">72.22% <small>(52 / 72)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Branches: <span class="metric">46.34% <small>(19 / 41)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Functions: <span class="metric">100% <small>(6 / 6)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Lines: <span class="metric">71.83% <small>(51 / 71)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../index.html">All files</a> &#187; <a href="index.html">mongoose-uuid/</a> &#187; index.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">31</span>
<span class="cline-any cline-yes">30</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">30</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">30</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">30</span>
<span class="cline-any cline-yes">480</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">30</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">30</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">480</span>
<span class="cline-any cline-yes">480</span>
<span class="cline-any cline-yes">24</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">456</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">30</span>
<span class="cline-any cline-yes">30</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">33</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">30</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">30</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">16</span>
<span class="cline-any cline-yes">16</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10</span>
<span class="cline-any cline-yes">10</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">'use strict';
&nbsp;
var mongoose = require('mongoose');
var bson = require('bson');
var util = require('util');
var uuid = require('node-uuid');
&nbsp;
var Document = mongoose.Document;
&nbsp;
function getter (binary){
  if(!binary) return undefined;
  var len = binary.length();
&nbsp;
  var b = binary.read(0,len);
&nbsp;
  var buf = new Buffer(len);
&nbsp;
  for (var i = 0; i &lt; len; i++)
    buf[i] = b[i];
&nbsp;
  var hex = '';
&nbsp;
  for (var i = 0; i &lt; len; i++)
  {
    var n = buf.readUInt8(i);
    if (n &lt; 16)
      hex += '0'+n.toString(16);
    else
      hex += n.toString(16);
  }
&nbsp;
  var uuidStr = hex.substr(0, 8) + '-' + hex.substr(8, 4) + '-' + hex.substr(12, 4) + '-' + hex.substr(16, 4) + '-' + hex.substr(20, 12);
  return uuidStr;
}
&nbsp;
function SchemaUUID(path, options){
  mongoose.SchemaTypes.Buffer.call(this, path, options);
  this.getters.push(getter);
}
&nbsp;
util.inherits(SchemaUUID, mongoose.SchemaTypes.Buffer);
&nbsp;
&nbsp;
SchemaUUID.schemaName = 'UUID';
&nbsp;
SchemaUUID.prototype.checkRequired = function (value) {
  return value instanceof mongoose.Types.Buffer.Binary;
};
&nbsp;
SchemaUUID.prototype.cast = function (value, doc, init) {
  if (mongoose.SchemaType._isRef(this, value, doc, init)) {
    // wait! we may need to cast this to a document
&nbsp;
    <span class="missing-if-branch" title="if path not taken" >I</span>if (value === null || value === undefined) {
<span class="cstat-no" title="statement not covered" >      return value;</span>
    }
&nbsp;
    <span class="missing-if-branch" title="else path not taken" >E</span>if (value instanceof Document) {
      value.$__.wasPopulated = true;
      return value;
    }
&nbsp;
    // setting a populated path
<span class="cstat-no" title="statement not covered" >    if (value instanceof mongoose.Types.Buffer.Binary) {</span>
<span class="cstat-no" title="statement not covered" >      return value;</span>
    } else <span class="cstat-no" title="statement not covered" >if (typeof value === 'string') {</span>
<span class="cstat-no" title="statement not covered" >      var uuidBuffer = new mongoose.Types.Buffer(uuid.parse(value));</span>
<span class="cstat-no" title="statement not covered" >      uuidBuffer.subtype(bson.SUBTYPE_UUID);</span>
<span class="cstat-no" title="statement not covered" >      return uuidBuffer.toObject();</span>
    } else <span class="cstat-no" title="statement not covered" >if (Buffer.isBuffer(value) || !util.isObject(value)) {</span>
<span class="cstat-no" title="statement not covered" >      throw new CastError('UUID', value, this.path);</span>
    }
&nbsp;
    // Handle the case where user directly sets a populated
    // path to a plain object; cast to the Model used in
    // the population query.
<span class="cstat-no" title="statement not covered" >    var path = doc.$__fullPath(this.path);</span>
<span class="cstat-no" title="statement not covered" >    var owner = doc.ownerDocument ? doc.ownerDocument() : doc;</span>
<span class="cstat-no" title="statement not covered" >    var pop = owner.populated(path, true);</span>
<span class="cstat-no" title="statement not covered" >    var ret = value;</span>
<span class="cstat-no" title="statement not covered" >    if (!doc.$__.populated ||</span>
        !doc.$__.populated[path] ||
        !doc.$__.populated[path].options ||
        !doc.$__.populated[path].options.options ||
        !doc.$__.populated[path].options.options.lean) {
<span class="cstat-no" title="statement not covered" >      ret = new pop.options.model(value);</span>
<span class="cstat-no" title="statement not covered" >      ret.$__.wasPopulated = true;</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    return ret;</span>
  }
&nbsp;
  <span class="missing-if-branch" title="if path not taken" >I</span>if (value === null || value === undefined) {
<span class="cstat-no" title="statement not covered" >    return value;</span>
  }
&nbsp;
  if (value instanceof mongoose.Types.Buffer.Binary)
    return value;
&nbsp;
  var uuidBuffer;
&nbsp;
  <span class="missing-if-branch" title="else path not taken" >E</span>if (typeof value === 'string') {
    uuidBuffer = new mongoose.Types.Buffer(uuid.parse(value));
    uuidBuffer.subtype(bson.SUBTYPE_UUID);
    return uuidBuffer.toObject();
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  throw new Error('Could not cast ' + value + ' to uuid.');</span>
};
&nbsp;
SchemaUUID.prototype.castForQuery = function ($conditional, val) {
  var handler;
  if (arguments.length === 2) {
    handler = this.$conditionalHandlers[$conditional];
    <span class="missing-if-branch" title="if path not taken" >I</span>if (!handler)
<span class="cstat-no" title="statement not covered" >      throw new Error("Can't use " + $conditional + " with Buffer.");</span>
    return handler.call(this, val);
  } else {
    val = $conditional;
    return this.cast(val);
  }
};
&nbsp;
module.exports = function (mongoose){
  mongoose.Types.UUID = mongoose.SchemaTypes.UUID = SchemaUUID;
}
&nbsp;</pre></td></tr>
</table></pre>

</div>
<div class="footer">
    <div class="meta">Generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sun May 07 2017 08:55:04 GMT+0000 (UTC)</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
